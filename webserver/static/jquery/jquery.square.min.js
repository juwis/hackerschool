!function(t){var e=function(){function e(e,i){this.set={target:"square",inner:".inner",scaleSplit:"_",width:150,height:150,space:10,speed:700,duration:500},this.disabled=!1,this.parentObj=null,this.target=null,this.resizeInter=null,this.prevWidth=null,this.width=0,this.height=0,this.space=0,this.isFloated=!1,i&&t.extend(this.set,i),this.parentObj=e.css("position","relative"),this.target=this.parentObj.find("*[class^="+this.set.target+"]").css("position","absolute"),this.prevWidth=this.parentObj.outerWidth(),this.isFloated=isNaN(this.set.width)&&this.set.width.match(/\%$/)||isNaN(this.set.space)&&this.set.space.match(/\%$/),this.setSize(),this.setPosition(0),t(window).on("resize.square",function(){this.resizeStart()}.bind(this))}return e.prototype.resizeStart=function(){t(window).off("resize.square"),this.disabled||(this.resizeInter=setInterval(function(){this.resizeCheck()}.bind(this),this.set.duration))},e.prototype.resizeCheck=function(){this.disabled||(this.prevWidth=this.parentObj.outerWidth(),this.prevWidth===this.parentObj.outerWidth()&&(clearInterval(this.resizeInter),t(window).on("resize.square",function(){this.resizeStart()}.bind(this)),this.resizeEnd()))},e.prototype.resizeEnd=function(){this.disabled||(this.isFloated&&this.setSize(),this.setPosition(this.set.speed))},e.prototype.setSize=function(){this.calcSize();var e=this;this.target.each(function(i){var s=e.getScale(t(this).attr("class")),h=e.width*s.x+e.space*(s.x-1),r=e.height*s.y+e.space*(s.y-1);t(this).css({width:h,height:r});var a=t(this).find(e.set.inner);if(a.length>0&&(a.height(r),a.outerHeight()>r)){var n=a.height()-(a.outerHeight()-r);a.height(n)}})},e.prototype.setPosition=function(e){var i=[],s={x:0,y:0},h=0,r=this;this.target.each(function(a){s=r.blankMatrix(i);var n=r.getScale(t(this).attr("class")),o=r.height*n.y+r.space*(n.y-1);for(r.checkSize(s.x,n)&&(s.x=0,s.y+=1);r.matrixCheck(i,s.x,s.y,n);)s.x+=1,r.checkSize(s.x,n)&&(s.x=0,s.y+=1);for(var c=0;c<n.x;c+=1)for(var p=0;p<n.y;p+=1)i[s.x+c]||(i[s.x+c]=[]),i[s.x+c][s.y+p]=!0;var d={x:r.space+r.width*s.x+r.space*s.x,y:r.space+r.height*s.y+r.space*s.y};e>0?r.goTween(t(this),{left:d.x,top:d.y},e):t(this).css({left:d.x,top:d.y}),h=d.y+o+r.space>h?d.y+o+r.space:h}),e>0?r.goTween(r.parentObj,{height:h},e):r.parentObj.css({height:h})},e.prototype.getScale=function(t){var e=t.split(" ");for(var i in e)if(e[i].match(this.set.scaleSplit)){var s=+e[i].split(this.set.scaleSplit)[1],h=+e[i].split(this.set.scaleSplit)[2];if(s)return h?{x:s,y:h}:{x:s,y:s}}return{x:1,y:1}},e.prototype.matrixCheck=function(t,e,i,s){if(!t)return!1;for(var h=0;h<s.x;h++)for(var r=0;r<s.y;r++)if(t[e+h]&&t[e+h][i+r])return t[e+h][i+r];return!1},e.prototype.blankMatrix=function(t){for(var e={x:0,y:0},i={x:1,y:1};this.matrixCheck(t,e.x,e.y,i);)e.x+=1,this.checkSize(e.x,i)&&(e.x=0,e.y+=1);return e},e.prototype.checkSize=function(t,e){var i=this.width*e.x+this.space*(e.x-1);return this.width*t+this.space*(t+2)+i>this.parentObj.outerWidth()},e.prototype.goTween=function(t,e,i){t.stop(!0,!1).animate(e,i)},e.prototype.calcSize=function(){if(isNaN(this.set.space)){if(this.set.space.match(/\%$/)){t=+this.set.space.replace("%","");this.space=this.parentObj.width()*(t/100)}}else this.space=this.set.space;if(isNaN(this.set.width)){if(this.set.width.match(/\%$/)){var t=+this.set.width.replace("%",""),e=Math.ceil(100/t);this.width=(this.parentObj.width()-this.space*(e+1))*(t/100)}}else this.width=this.set.width;this.height=this.set.height},e.prototype.destroy=function(){this.disabled=!0,this.resizeInter&&clearInterval(this.resizeInter),t(window).off(".square"),this.parentObj.attr("style",""),this.target.attr("style","")},e}();t.fn.extend({square:function(i){return new e(t(this),i)}})}(jQuery);